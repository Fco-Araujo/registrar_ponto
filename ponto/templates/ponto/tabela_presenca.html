{% extends "base.html" %}
{% load static %}
{% block content %}
<style>
  body {
    font-family: Arial, sans-serif;
    background-color: #f3f3f3;
    margin: 0;
    padding: 20px;
  }
  .container {
    max-width: 100%;
    overflow-x: auto;
    background: white;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 0 10px rgba(0,0,0,0.1);
  }
  h1 {
    text-align: center;
    margin-bottom: 20px;
    color: #333;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    text-align: center;
  }
  th, td {
    border: 1px solid #ccc;
    padding: 6px;
    min-width: 30px;
  }
  .titulo {
    color: black;
  }
  th {
    background-color: #007acc;
    color: white;
    position: sticky;
    top: 0;
    z-index: 10;
  }
  td:first-child, td:nth-child(2), th:first-child, th:nth-child(2) {
    background-color: #f0f0f0;
    font-weight: bold;
    position: sticky;
    left: 0;
    z-index: 5;
  }
  td:nth-child(2), th:nth-child(2) {
    left: 120px;
  }
  .total-row {
    background-color: #f0f8ff;
    font-weight: bold;
    color: #003366;
  }
  .filters {
    display: flex;
    flex-wrap: wrap;
    gap: 15px;
    margin-bottom: 20px;
    justify-content: center;
    align-items: center;
    padding: 15px;
    background-color: #eef6fb;
    border-radius: 8px;
  }
  .filters label {
    font-weight: bold;
    margin-right: 5px;
    color: #333;
  }
  .filters select, .filters input {
    padding: 6px 10px;
    border: 1px solid #ccc;
    border-radius: 6px;
    background-color: #fff;
    font-size: 14px;
  }
</style>

<div class="container">
  <h1>Controle de Presença{% if mes_atual %} - {{ mes_atual|date:"F/Y" }}{% endif %}</h1>

  <form method="get" class="filters">
    <label for="mes">Mês:</label>
    <select id="mes" name="mes">
      {% for m in meses_disponiveis %}
        <option value="{{ m|date:"Y-m" }}" {% if m == mes_atual %}selected{% endif %}>
          {{ m|date:"F/Y" }}
        </option>
      {% endfor %}
    </select>

    <label for="cpf">CPF:</label>
    <input
      type="text"
      id="cpf"
      name="cpf"
      placeholder="Digite o CPF"
      maxlength="14"
      value="{{ cpf }}"
      pattern="(\d{11}|(\d{3}\.\d{3}\.\d{3}-\d{2}))"
      inputmode="numeric"
      oninput="this.value = this.value.replace(/[^0-9.-]/g, '').slice(0,14);"
    />

    <label for="setor">Setor:</label>
    <select id="setor" name="setor">
      <option value="" {% if not setor %}selected{% endif %}>Todos</option>
      {% for s in setores %}
        <option value="{{ s }}" {% if s == setor %}selected{% endif %}>{{ s }}</option>
      {% endfor %}
    </select>

    <button type="submit">Filtrar</button>
  </form>

  {% if tabela %}
    <table>
      <thead>
        <tr>
          <th class="titulo">Funcionário</th>
          <th class="titulo">CPF</th>
          {% for dia in dias %}
            <th>{{ dia }}</th>
          {% endfor %}
        </tr>
      </thead>
      <tbody>
        {% for colaborador, presencas in tabela.items %}
          <tr>
            <td>{{ colaborador.0 }}</td>
            <td>
              {{ colaborador.1|slice:":3" }}.{{ colaborador.1|slice:"3:6" }}.{{ colaborador.1|slice:"6:9" }}-{{ colaborador.1|slice:"9:11" }}
            </td>
            {% for status in presencas %}
              <td>{% if status == 'S' %}S{% else %}&nbsp;{% endif %}</td>
            {% endfor %}
          </tr>
        {% endfor %}
      </tbody>
    </table>
  {% else %}
    <p>Nenhum dado encontrado.</p>
  {% endif %}
</div>

{% endblock %}
